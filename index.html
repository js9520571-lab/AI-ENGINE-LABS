<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Engine Pro Studio</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        .sidebar { background: #0f172a; width: 300px; height: 100vh; border-right: 1px solid #1e293b; overflow-y: auto; }
        .canvas-area { background: radial-gradient(circle, #1e293b 1px, transparent 1px); background-size: 20px 20px; }
        .tool-btn { @apply w-full py-3 px-4 rounded-xl text-sm font-semibold transition-all flex items-center gap-3 mb-2; background: #1e293b; }
        .tool-btn:hover { background: #3b82f6; transform: translateX(5px); }
        canvas { border-radius: 8px; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
    </style>
</head>
<body class="flex">

    <aside class="sidebar p-6">
        <h2 class="text-blue-500 font-black text-xl mb-8 tracking-tighter">Q-ENGINE PRO</h2>
        
        <div class="mb-6">
            <p class="text-[10px] text-gray-500 font-bold uppercase mb-3">Draw & Write</p>
            <button onclick="toggleDrawing()" id="drawBtn" class="tool-btn">âœï¸ Free Draw Mode</button>
            <button onclick="addText()" class="tool-btn">âœï¸ Smart Typography</button>
        </div>

        <div class="mb-6">
            <p class="text-[10px] text-gray-500 font-bold uppercase mb-3">Advanced Effects</p>
            <button onclick="applyGradient()" class="tool-btn">ğŸŒˆ Apply Gradient</button>
            <button onclick="applyShadow()" class="tool-btn">ğŸŒ‘ Add Soft Shadow</button>
            <button onclick="applyFilter('Sepia')" class="tool-btn">ğŸ“¸ Sepia Filter</button>
            <button onclick="applyFilter('Grayscale')" class="tool-btn">âšª B&W Filter</button>
        </div>

        <div class="mb-6">
            <p class="text-[10px] text-gray-500 font-bold uppercase mb-3">Import & Export</p>
            <label class="tool-btn cursor-pointer bg-blue-600 hover:bg-blue-500 text-center justify-center">
                ğŸ“ Upload Asset <input type="file" id="imgLoader" class="hidden" onchange="handleImage(event)">
            </label>
            <button onclick="exportCanvas()" class="w-full py-4 bg-emerald-500 text-black font-black rounded-xl mt-4">EXPORT 4K PNG</button>
        </div>

        <button onclick="canvas.clear(); canvas.backgroundColor='#fff'; canvas.renderAll();" class="text-xs text-red-500 underline mt-10">Reset Canvas</button>
    </aside>

    <main class="flex-1 canvas-area flex items-center justify-center relative">
        <canvas id="mainCanvas"></canvas>
    </main>

    <script>
        // 1. Core Engine Initialization
        const canvas = new fabric.Canvas('mainCanvas', {
            width: 900, height: 600, backgroundColor: '#ffffff', isDrawingMode: false
        });

        // 2. Tech: Free Drawing
        function toggleDrawing() {
            canvas.isDrawingMode = !canvas.isDrawingMode;
            canvas.freeDrawingBrush.width = 5;
            canvas.freeDrawingBrush.color = "#3b82f6";
            document.getElementById('drawBtn').style.background = canvas.isDrawingMode ? '#3b82f6' : '#1e293b';
        }

        // 3. Tech: Smart Typography
        function addText() {
            canvas.add(new fabric.IText('Q-Engine Labs 2026', { left: 100, top: 100, fontFamily: 'Arial Black', fill: '#0f172a' }));
        }

        // 4. Tech: Advanced Gradients
        function applyGradient() {
            const obj = canvas.getActiveObject();
            if (!obj) return alert("Select a shape first!");
            obj.set('fill', new fabric.Gradient({
                type: 'linear', coords: { x1: 0, y1: 0, x2: obj.width, y2: 0 },
                colorStops: [ { offset: 0, color: '#3b82f6' }, { offset: 1, color: '#10b981' } ]
            }));
            canvas.renderAll();
        }

        // 5. Tech: Soft Shadows
        function applyShadow() {
            const obj = canvas.getActiveObject();
            if (!obj) return;
            obj.set('shadow', new fabric.Shadow({ color: 'rgba(0,0,0,0.3)', blur: 20, offsetX: 10, offsetY: 10 }));
            canvas.renderAll();
        }

        // 6. Tech: Image Filters
        function applyFilter(type) {
            const obj = canvas.getActiveObject();
            if (obj && obj.type === 'image') {
                const filter = type === 'Sepia' ? new fabric.filters.Sepia() : new fabric.filters.Grayscale();
                obj.filters.push(filter);
                obj.applyFilters();
                canvas.renderAll();
            } else { alert("Please select an uploaded image."); }
        }

        // 7. Asset Handling
        function handleImage(e) {
            const reader = new FileReader();
            reader.onload = f => fabric.Image.fromURL(f.target.result, img => {
                img.scaleToWidth(300); canvas.add(img);
            });
            reader.readAsDataURL(e.target.files[0]);
        }

        function exportCanvas() {
            const link = document.createElement('a');
            link.download = 'Q-Project-2026.png';
            link.href = canvas.toDataURL({ format: 'png', quality: 1 });
            link.click();
        }

        // --- SECURITY: ANTI-INSPECT ---
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.onkeydown = e => {
            if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && [73, 74, 67].includes(e.keyCode)) || (e.ctrlKey && e.keyCode == 85)) return false;
        };
    </script>
</body>
</html>
